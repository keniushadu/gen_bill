(function(){AP.cache.xbox={};var b=new AP.Class({options:{},cfg:{MOCK:"xbox-mock",MOCK_CLASS:"xbox-mock",LOAD:"xbox-load",IFRAME:"xbox-iframe",IFRAME_FIX:"xbox-hide-select",OVERLAY:"xbox-overlay",OVERLAY_BG:"xbox-overlay-bg"},setOptions:function(c){return AP.hashExtend({el:"",type:"string",value:"",modal:true,width:600,height:"",maxWidth:800,maxHeight:500,minHeight:null,autoFit:true,autoShow:false,border:true,onShowEvent:false,onHideEvent:false,noScroll:false,fixed:false,load:false,cross_domain:false,loadsrc:"https://i.alipayobjects.com/e/201311/1PYOj9Ocdx.gif"},c,true)},initialize:function(d){var c=this;this.options=this.setOptions(d);this._preLoadImg();this._bindEvent();E.on(document,"keyup",function(f){if(E.getCharCode(f||window.event)==27){AP.widget.xBox.hide();try{parent.AP.widget.xBox.hide()}catch(f){}}});if(this.options.onHideEvent){AP.cache.xbox.onHideEvent=this.options.onHideEvent}},_preLoadImg:function(){var c=new Image();c.src=this.options.loadsrc},_bindEvent:function(){if(this.options.el!==false&&this.options.el!==""){E.on(this.options.el,"click",function(d,c){c.fire.call(c,this,c);E.preventDefault(d)},this)}E.on(D.query(".xbox-close-link"),"click",function(c){AP.widget.xBox.hide();E.preventDefault(c)})},_makeValue:function(){var c=this.options.value,d=this.options.type;if(typeof(c)=="function"){return c.call(this,AP.cache.xbox.fireObject)}if(d==="iframe"){return c}else{if(/^[a-zA-Z]([^#.\s]*)[a-zA-Z0-9]$/.test(c)){return D.get(c)}else{if(/^[a-zA-Z#\.]*(\s?)(.*)[a-zA-Z0-9]$/.test(c)){return D.query(c)[0]}else{return c.toString()}}}},_fixUrl:function(c){return c+(c.indexOf("?")<0?"?_xbox=true":"&_xbox=true")},_getType:function(d){var c;return((c=typeof(d))=="object"?d==null&&"null"||Object.prototype.toString.call(d).slice(8,-1):c).toLowerCase()},_getOptWidth:function(){var c;try{if(parent&&parent.D.get("xbox-iframe")&&(parent.D.get("xbox-iframe").getAttribute("auto-width")>0)){c=parent.D.get("xbox-iframe").getAttribute("auto-width")}else{c=parseInt(this.options.width,10)}}catch(d){c=parseInt(this.options.width,10)}this.options.width=c;return c},_getOptHeight:function(){return parseInt(this.options.height,10)},_getType:function(d){var c;return((c=typeof(d))=="object"?d==null&&"null"||Object.prototype.toString.call(d).slice(8,-1):c).toLowerCase()},_getNiceTop:function(c){var h=D.get(this.cfg.MOCK),h=this.options.type.toLowerCase()=="dom"?h.firstChild:h,f=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop,g,e=D.getViewportHeight(),d;if(c){_mH=parseInt((this._getIFRHeight()||D.getStyle(this.cfg.MOCK,"height")),10)}else{_mH=this._getWH(h)[1]}g=e>_mH?(0.382*e-_mH/2):50;g=Math.max(50,g)+f;g=Math.max(50,g);return parseInt(g,10)},_getNiceLeft:function(){var e=D.get(this.cfg.MOCK),c=this._getWH(e)[0],d=(D.getViewportWidth()-5-c)/2;return parseInt(d,10)},_getWH:function(f){var f=typeof f=="string"?document.getElementById(f):f,c,d;if(f.offsetWidth===0||f.offsetHeight===0){var j=f.style.display||"",g=f.style.visibility||"",i;f.style.visibility="hidden";f.style.display="block";i=document.createElement("div");i.style.visibility="hidden";i.appendChild(f.cloneNode(true));document.body.appendChild(i);f=i.firstChild;try{f.style.visibility=g;f.style.display=j;document.body.removeChild(i)}catch(h){}}c=f.offsetWidth>this.options.maxWidth?this.options.maxWidth:f.offsetWidth;d=f.offsetHeight>this.options.maxHeight?this.options.maxHeight:f.offsetHeight;return[f.offsetWidth,f.offsetHeight]},_contentOnLoad:function(e){e.hideLoad.call(e);var c=D.get(this.cfg.MOCK),f=this.options.type.toLowerCase()==="dom"?c:c.firstChild,d=e._getWH(f);D.setStyles(e.cfg.MOCK,{width:(e._getOptWidth()||d[0])+"px"});D.setStyles(e.cfg.MOCK,{top:e._getNiceTop(false)+"px",left:e._getNiceLeft()+"px",visibility:"visible"})},_iframeOnLoad:function(d,c){this.hideLoad();this._fitIFR();D.setStyle(this._mock,"top",this._getNiceTop(true)+"px");D.setStyle(this.cfg.IFRAME,"height",this._getIFRHeight()+"px");if(this.options.autoFit){this._autoFit()}D.setStyle(this._iframe,"visibility","visible");D.setStyle(this._mock,"visibility","visible");if(AP.env.browser.mozilla&&AP.env.browser.v==="1.9.0.15"){if(document.location.host.indexOf("cashier")<1){this.cfg.autoFit=false}D.get(this.cfg.IFRAME).style.height=parseInt(D.get(this.cfg.MOCK).style.height,10)+1+"px"}try{E.on(D.query(".xbox-close-link",D.get(this.cfg.IFRAME).contentWindow.document),"click",function(f){AP.widget.xBox.hide();E.preventDefault(f)})}catch(d){}},_fitIFR:function(){try{var c=D.get(this.cfg.MOCK);D.setStyles(this.cfg.MOCK,{width:this._getOptWidth()+"px",height:this._getIFRHeight()+"px",left:((D.getViewportWidth()-this.options.width)/2)+"px"});D.setStyle(this.cfg.IFRAME,"width",this._getOptWidth()+"px");D.setStyle(this.cfg.IFRAME,"height",this._getIFRHeight()+"px");if(D.getStyle(this.cfg.MOCK,"height")+D.getStyle(this.cfg.MOCK,"top")>D.getViewportHeight()){D.setStyle(this.cfg.MOCK,"top",this._getNiceTop(true)+"px")}}catch(d){}},_autoFit:function(){try{var c=this;if(AP.cache.xbox.timer){clearInterval(AP.cache.xbox.timer)}AP.cache.xbox.timer=setInterval(function(){c._fitIFR()},75)}catch(d){}},_getIFRHeight:function(){if(this.options.cross_domain&&this.options.height){return this.options.height}var f=D.get(this.cfg.IFRAME);try{var d=f.contentWindow.document.body.scrollHeight,g=f.contentWindow.document.documentElement.scrollHeight,e=window.userAgent,c=(e.indexOf("safari")>-1||e.indexOf("chrome")>-1)?Math.min(d,g):Math.max(d,g);if(g-d>100){c=d}if(parseInt(this.options.minHeight,10)>0&&this.options.minHeight>c){c=this.options.minHeight}return c}catch(h){}},_makeContent:function(){switch(this.options.type.toLowerCase()){case"iframe":this.options.load=true;this._iframe=Element.create("iframe",{id:this.cfg.IFRAME,name:this.cfg.IFRAME+new Date().getTime(),frameBorder:"no",scrolling:"no",src:this._fixUrl(this._makeValue()),style:{visibility:"hidden",width:this._getOptWidth()+"px"}});E.on(this._iframe,"load",this._iframeOnLoad,this,true);this._mock.appendChild(this._iframe);break;case"dom":var c=this._makeValue();AP.cache.xbox.DOMParent=c.parentNode;this._mock.appendChild(c);E.onContentReady(this.cfg.MOCK,this._contentOnLoad,this,true);break;case"string":this._mock.innerHTML+=this._makeValue();E.onContentReady(this.cfg.MOCK,this._contentOnLoad,this,true);break;default:break}},renderMock:function(){if(D.get(this.cfg.MOCK)){return}this._mock=Element.create("div",{id:this.cfg.MOCK,"class":this.cfg.MOCK_CLASS,style:{visibility:"hidden",display:""},appendTo:document.body});if(!this.options.border){this._mock.style.border="none"}if(this.options.title&&this.options.title!==""){var c=Element.create("div",{"class":"xbox-caption",innerHTML:this.options.title,appendTo:this._mock})}this._makeContent()},showMock:function(){D.setStyle(this._mock,"visibility","visible")},renderOverlay:function(){var d=this.cfg.OVERLAY;var c=document.body.scrollWidth>document.body.offsetWidth?document.body.scrollWidth:document.body.offsetWidth+50+"px";var e=D.getDocumentHeight();if(!D.get(this.cfg.OVERLAY)){this._overlay=Element.create("div",{id:this.cfg.OVERLAY,"class":this.cfg.OVERLAY_BG,style:{height:e+"px",visibility:"hidden",opacity:"0",filter:"alpha(opacity=0)","-moz-opacity":"0"},appendTo:document.body})}if(AP.fn.browser.msie6){if(this.options.noScroll){}else{c="100%"}D.setStyle(this.cfg.OVERLAY,"height",e);D.setStyle(this.cfg.OVERLAY,"width",c)}if(!D.get(this.cfg.IFRAME_FIX)){this._overlay.innerHTML='<iframe id="'+this.cfg.IFRAME_FIX+'" style="width: '+c+"px; height:"+e+'px" src="javascript:\'\'"></iframe>';d=this.cfg.IFRAME_FIX}if(AP.env.browser.msie&&AP.env.browser.v<8||AP.env.browser.mozilla===true){var f=D.query(".alieditContainer");if(f.length>0){f.forEach(function(g){g.style.visibility="hidden";g.style.opacity="0";g.style.filter="alpha(opacity = 0)";AP.cache.hidePWDEdit=true})}}if(AP.env.browser.mozilla&&AP.env.browser.v==="1.9.1.9"){D.get(this.cfg.IFRAME_FIX).style.display="none"}},showOverlay:function(){var c=this;D.setStyle(this.cfg.OVERLAY,"visibility","visible");var d=new U.Anim(this.cfg.OVERLAY,{opacity:{from:0,to:0.2}},0.3);if(AP.env.browser.msie&&AP.env.browser.v>=9){d.onComplete.subscribe(function(){D.get(c.cfg.OVERLAY).style.opacity=0.2})}if(this.options.type.toLowerCase()==="iframe"){d.onStart.subscribe(function(){c.showLoad()})}d.animate()},hideOverlay:function(){E.removeListener(this.cfg.OVERLAY);var c=new U.Anim(this.cfg.OVERLAY,{opacity:{to:0}},0.2);c.onComplete.subscribe(function(){Element.remove(this.cfg.OVERLAY)});c.animate()},showLoad:function(){if(D.get(this.cfg.LOAD)){return}var c=D.getViewportHeight()*0.382;if(AP.fn.browser.msie6){c+=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}Element.create("div",{id:this.cfg.LOAD,innerHTML:"<img src='"+this.options.loadsrc+"' />",style:{top:c+"px",display:"block"},appendTo:document.body})},hideLoad:function(){if(D.get(this.cfg.LOAD)){Element.remove(this.cfg.LOAD)}},show:function(){var c=this;this.renderOverlay();this.renderMock();this.showOverlay.call(c);if(this.options.onShow){this.options.onShow.call(this)}if(this.options.onShowEvent){this.options.onShowEvent.call(this)}var d=D.query("#xbox-mock .alieditContainer");if(d.length>0){d.forEach(function(e){e.style.visibility="visible";e.style.opacity="1";e.style.filter="alpha(opacity = 1)"})}},hide:a,fire:function(f,c){var d=c||this;AP.cache.xbox.fireObject=f;d.show.call(d,f,d);if(f){E.preventDefault(f)}}});function a(){try{setTimeout(function(){D.setStyles(D.query("div.cal-calendar"),{display:"none"})},0)}catch(h){}if(AP.cache.xbox.timer){clearInterval(AP.cache.xbox.timer)}if(AP.cache.xbox.DOMParent){var d=D.get("xbox-mock").firstChild;if(D.hasClass(d,"xbox-caption")){d=d.nextSibling}AP.cache.xbox.DOMParent.appendChild(d)}try{if(AP.env.browser.msie&&AP.env.browser.v<8||AP.env.browser.mozilla===true){var i=D.query(".alieditContainer");if(i.length>0&&AP.cache.hidePWDEdit){i.forEach(function(e){e.style.visibility="visible";e.style.opacity="1";e.style.filter="alpha(opacity = 100)";AP.cache.hidePWDEdit=true})}}}catch(h){}try{E.removeListener(document,"keyup");E.removeListener("xbox-mock");E.removeListener("xbox-overlay")}catch(h){}var c=D.get("xbox-mock");var g=D.get("xbox-overlay");if(c){document.body.removeChild(c)}if(g){document.body.removeChild(g)}try{if(AP.cache.xbox.onHideEvent){AP.cache.xbox.onHideEvent.call();var f=AP.cache.xbox.onHideEvent}}catch(h){}AP.cache.xbox={};AP.cache.xbox.onHideEvent=f}AP.widget.xBox=b;AP.widget.xBox.hide=a})();